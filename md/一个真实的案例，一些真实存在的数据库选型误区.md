> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/m7wJdS5PcZXKntLTBjTg7w)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/jYB6WXyGuicfoSgsaibGk18b43qUwjE1N7W34ic7jicYea61L7FoCVZa2gDcsoic3FdmKIicH7ibl3nvBGUQvtQPU6CXA/640?wx_fmt=jpeg)

_题图来自 Unsplash_

最近，老鱼听说了一个案例！

某银行计划部署分布式数据库来替换业务核心的集中式数据库。先期计划在某一核心业务进行试点，然后根据试点情况，再决定是否继续大规模实施。  

试点的核心业务使用的是 “O” 记数据库，一个 3 节点 RAC ，3 台小型机， 2 台用于业务系统，1 台放在同城灾备中心作为远程数据备份。替换后，数据库为某分布式数据库，使用多达 600 多台的 X86 服务器。

目前，该试点业务已经部署完成，峰值性能（TPS）较替换前提高 50%，平均性能（TPS）提升 33.3%，平均事务响应时间未知。

最终，该银行决定不再继续实施，而是维持现状。

到这里，相信大家应该也能看出点什么。

_3 节点 RAC 能做的事，为什么需要如此多的 X86？_

没错，即使不同银行的核心业务复杂度有所差异，即便替换后有 50% 的性能提升，但是！但是！但是！重要的事情说 3 遍，反正，在老鱼询问了多位专家后，大家观点是完全一致的，都不认为需要如此之多的机器，这是在烧钱！即便不差钱，也应该考虑给开发和运维团队在未来工作中带来剧增的额外工作量及复杂度。

如果是由于分布式事务导致网络延迟，因此需要更多的服务器，只能说明这个分布式数据库架构设计差强人意。平均事务响应时间未知，这是因为在应用层实现了？那以上网络延迟又被推翻。

这个项目 5 年 TCO 并不难测算，投入破亿是肯定的。硬件成本（服务器、交换机等）、软件成本（操作系统、数据库授权），包含第四 / 五年维保成本都很容测算。

但有一项成本可能很容易被忽略，那就是运维成本，它或许会占到整体采购成本的 20-30%。分布式数据库运维是痛点，分布式改造后运维和开发的工作量必然激增。

从运维角度看，因为硬件大量增加，假设原来 3 台小型机只需要 2 个运维，那现在 600 多台 X86 需要的运维就得翻倍，甚至更多。假设一个运维平均年薪 20 万，5 年就是 100 万，如果增加 3 个就是 300 万。其次，大量增加的机器，势必导致电费、散热、机房使用等成本提升。

从开发角度看，架构的改变，很少不动应用的，甚至完全重构应用都有可能。

因此，无论是从性能还是成本来说，这个案例都是没有性价比的。

虽然这个案例有些极端，但反映出的一些市场上真实存在的潜在问题或认知误区，值得我们去深入探讨。

最近几年，分布式数据库成为潮流，在各种光环加持下，仿佛黑暗中的灯塔，难免有些过度神话了。

不仅各路厂商或主动、被动的发布自己的分布式数据库产品，市场产品群雄逐鹿。很多传统企业也在纷纷试水分布式数据库。大有不上分布式数据库就要被时代淘汰，没用过分布式数据库就显得特别 LOW 的架势。

在试水的企业中，有成功的，也有失败的。由于分布式数据库尚无统一的业界标准，因此，各有各的看法。

老鱼认为，没有万能的数据库，只有最合适的数据库。

分布式数据库虽好，但也并非万能 “银弹”，也分场景，也有自己的短板。而要清楚当前分布式数据库的最佳适用场景，这就要从分布式数据库的历史背景及走红原因说起。

历史

背景

分布式数据库在数据库历史的早期就有了，其研究始于 20 世纪 70 年代，世界上第一个分布式数据库系统 SDD-1 是由美国计算机公司（CCA）于 1979 年在 DEC 计算机上实现。  

但分布式数据库直到最近几年才被关注，其原因也是多方面的。

在互联网诞生以前，企业数据规模不大，以 “O” 记为代表的传统数据库足以满足绝大多数数据管理的需求，因此，分布式数据库并无用武之地，这其中还有两个方面的原因，首先，这个时期，市面并没有较好的分布式数据库产品，其次，分布式数据库本身不可以免的存在一些缺陷。

但进入互联网时代以后，面对时刻增长的海量数据、同时在线的海量用户，传统数据库的已经难以支撑业务发展。于是，以互联网行业为首的企业开始探索有效的解决方案。

先是 NoSQL 发展起来，NoSQL 牺牲了关系型数据库的一些限制，例如：强一致性，为数据处理带来的扩展性。之后又催生了 NewSQL，定义了一种新型的数据库，兼具扩展性与传统关系型数据库的特性，最典型的代表就是基于谷歌 Spanner/F1 论文。

在这个过程中，传统数据库也在进行自我救赎，最常见的就是分库分表方式，但这种解决方案需要应用系统做大量改造，需要感知数据存储位置，同时增加了运维复杂性。

于是，就有了分布式数据库的两种技术路线：开源数据库 + 分布式中间件的解决方案，比如 MyCat，优点是可以利用现有开源数据库成熟稳定的产品功能，缺点是中间件毕竟只是一种迂回的方式，会受限于单机数据库的功能。

另一种技术路线即原生分布式数据库，天生具有分布式的特性，从设计之初就是针对分布式架构进行设计的，缺点是产品成熟度还有待提升，还需要经过不同场景、不同规模数据量和不同行业应用的检验、改进和完善。

目前，一般性的共识是数据量不上一定规模，没有超高峰值，没有高并发的场景就没必要用分布式数据库，因为，很可能不但不能获得什么明显优势，还要牺牲集中式的单机扩展性和开发及运维简单便捷性。

如果只是为了实现国产化替代，其实一些国产关系型数据库也能满足需求，并没有必要直接上分布式数据库。

总的来说，分布式数据库的优点是扩展性好，数据能分散存储在多个节点，能实现水平扩展。并且多个节点，可以并行执行，提高了整体的吞吐。

缺点是分布式事物处理的代价较高，这种代价主要源于两阶段的提交造成过多的消息传输；可能的锁争用变大；复制多副本和高可用。其次，产品成熟度有待提升，运维复杂。

常见

误区

**1、分布式改造只是个技术问题**

从传统集中式架构改造为分布式架构，并非一个简单的技术问题，而是一个技术生态切换的问题。

数据库的分布化，带来的不仅是数据库系统重构，还有应用系统的重构。分布式数据库一般不支持存储过程，SQL 执行效率低，而这些问题通常只能在应用端解决。

相比传统数据库，分布式数据库的开发和运维的技术要求会提高一个档次，民生银行的技术负责人就曾表示，分布式改造时，开发一个智能化的运维平台非常重要。

因此，上分布式数据库前，需要做好整体规划，在资金、环境改造，人员技能、管理自动化和技术储备等各个方面做好充分准备。

**2、分布式改造会降低 TCO**

分布式数据库有两种技术路线：开源数据库 + 分布式中间件，原生分布式数据库。由于研发分布式数据库产品的公司多为互联网、创业公司等，它们一般都以使用 MySQL 为主，因此，很多人认为部署分布式数据库，软件采购费用会降低，X86 替代 RISC，硬件单价会大幅降低，所以，TCO 会降下来。但实际情况也可能并非如此。

比如本文开头的案例，就是个例子，当然这个案例有点极端，再举个例子。

某全国性银行的信用卡系统，原数据库系统为 4 台小型机，分布化改造后，需要 120 台数据库服务器，软硬件采购成本降低了 50%，但是运维人员增长了 66%，开发人员增长了 5 倍，计算 5 年整体拥有成本，比原来提高了 60% 以上。节省的采购成本并不能覆盖后期增加的运维和开发成本。

从这个案例看，分布式改造只是降低了首次购买成本 TCA，整体拥有成本 TCO 并没有降低。

**3、不发掘现有系统潜力，盲目照搬互联网模式**

有句俗话叫 “技术跟着业务走”。IT 架构的进化升级需要与企业业务转型同步，落后则制约业务发展，激进则会造成投资浪费，甚至给业务带来风险。

传统企业和互联网公司的业务相比有着根本性的不同。互联网公司有三个显著的特点，即海量的用户、用户的高频访问和交易、业务的高频创新，比如抖音、快手、今日头条，一年时间就可以发展几千万用户，每个用户每天多次登陆使用。所以，IT 基础架构一定以扩展性、灵活性为第一追求。

传统企业的核心业务相对稳定，而且用户数量有限，交易频率不高，开发人员少、IT 支出少，业务对于 IT 的需求同互联网公司有着根本性的差异。很难承受分布式改造带来的经济成本和技术风险，通常只能依托第三方提供的整体方案和服务，因此，对于这类企业，传统的集中式数据库仍然是最好的选择。

比如本文开头的案例，要提高数据库系统性能，只需要把硬件平台从双路、四路服务器升级到八路、十六路等大型服务器上，就可以覆盖绝大部分业务需求。成本未必比直接上分布式高，甚至可能还要低。目前，国产服务器、小型机品类齐全，价格也很透明。如果这样还不够，就来个 RAC 集群，不少国产关系型数据库也大都有 RAC 集群扩展方案。

写在

最后

总的来说，用什么数据库，完全取决于业务需求。

业务用数据库来做什么？分析还是交易？或者两者兼而有之？业务要处理什么样的数据？对数据库性能需求是什么？

如果是传统的 ERP、CRM、财务等与 “钱” 相关的核心业务系统，需要事务完整性，保证 ACID 事务，那么，毫无疑问，传统的集中式关系型数据库是最佳选择。

业务要处理什么样的数据？结构化？半结构化？非结构化数据？决定需要支持的数据模型。原则上 “什么数据模型，就用什么库。”

如果你要存储和处理的是图片、音频、视频等非结构化数据，那么，NoSQL 数据库会是最佳选择。进一步来说，业务要存储游戏场景中的角色信息、经验道具信息、好友排名等信息，而这些信息一般都和 ID（键）挂钩，那么，键值数据库是个很好的选择。

业务需要处理的多大的数据规模、并发吞吐量、响应时间需求是什么？决定了对数据库的性能需求。

如果业务是秒杀，春节火车票等，有超高峰值、高并发的业务，那么，分布式数据库会是一个不错的选择。

综上所述，虽然针对架构和数据库选型的讨论会一直存在，但归其核心，一定要明确的一点就是：“业务需求主导技术创新 “，理性分析和对待架构和分布式数据库的选型，选择业务场景最适合的架构和数据库才是王道。

- END -

延伸阅读

[数据库大战, AWS 又向微软 SQL Server 宣战](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672928&idx=1&sn=0425d83e8c97bf675b7673ebcec8d2c0&chksm=84fdce1db38a470b54f75560cf1a57d6b96bc31df0aae60587678848d69cd4ad49cee742253e&scene=21#wechat_redirect)

[达梦的同学给我发来一封邀请函](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672900&idx=1&sn=998264cdcbc19e37e2e2d8cba67dbf09&chksm=84fdce39b38a472fcdf59ea019a5efeb647c794d66efda788f1e091e8292c1407c65455ec5ee&scene=21#wechat_redirect)

[开源数据库虽香，但需警惕风险勿沦为 “韭菜”](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672881&idx=1&sn=ec92617b5d2f5663cb5865d74e1745ba&chksm=84fdce4cb38a475af812b90934be45b04ef177430abc24f47364598432f1f0d6649c0e549959&scene=21#wechat_redirect)

[这些著名数据库之间的 “关系”，你知道吗？](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672871&idx=1&sn=b611a159613e08e2c8c14627ea9e553e&chksm=84fdce5ab38a474cd157e35945921643965f96d5dcc177632d07f59c248d01246ee287a79e7a&scene=21#wechat_redirect)

[国产分布式数据库怎么选？我做了三张表!](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672800&idx=1&sn=c1b612b6b452974c73d69b8ff136773a&chksm=84fdce9db38a478ba9cf00bee253f6d29fe7996519309c2906a9ad8caca2a028e1b04da03163&scene=21#wechat_redirect)

[上半年 13 家数据库公司项目签约及验收盘点](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672814&idx=1&sn=8f41c27ee78efd14193e587e3b43776a&chksm=84fdce93b38a4785a22b7f3a1ff8434766b9dba45c877311207d353b12ac3072a4949872ee64&scene=21#wechat_redirect)

[国内首份《云数据库选型及满意度调查报告》](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672592&idx=1&sn=6fd5b770deec99778aeba1adbfccbd37&chksm=84fdcf6db38a467bc0d6b8577402c369089f3d166d4800d27378c1c6c94e352d18b77f61a4c0&scene=21#wechat_redirect)

[华为 “高斯” 战记](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672394&idx=1&sn=c1cc3eea3841ecad6ec9404c9e0f583c&chksm=84fdcc37b38a4521f9b5a1e625b4acf638eb84903a52585c1f3f5dd9122b81970f7465f58450&scene=21#wechat_redirect)

[中兴数据库的决心](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672426&idx=1&sn=8eb9b3a31c730779b4fe5b80b819bcf4&chksm=84fdcc17b38a4501170d8e41f934ebf67013d066d03f2cc41dd9e9cc532dca9988691a07a1e5&scene=21#wechat_redirect)

[OceanBase 二刷 TPC-C，这次纪录很残暴](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672658&idx=1&sn=41b07f24b7ae18c3fa9ca786c5d58033&chksm=84fdcf2fb38a46394554a6319486d7eeb19b69517bb6de1dff0aa739350e3d78916c0241c3f8&scene=21#wechat_redirect)

[尴尬! 3/4 的 Sybase 用户无意迁往 SAP HANA](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672505&idx=1&sn=edcdc448a2a3d66f75ccdeb20e81b911&chksm=84fdcfc4b38a46d2d34c87cb01d966fa456e11ffca3f079e70522bf4b9002024166639373d92&scene=21#wechat_redirect)

[独家对话甲骨文 CEO 马克 · 赫德](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672250&idx=1&sn=be75689ddfbacadbab415235e09eb8f6&chksm=84fdccc7b38a45d184c8f12993258e4ea7b106d160ca16ef9fe6cccac841137e89939b477a26&scene=21#wechat_redirect)

[对话李飞飞：](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672402&idx=1&sn=84bbac456446dfae896e891ae1fe8b97&chksm=84fdcc2fb38a45394cea7d367eb865a9acc1c9c261c8abe5053452649e01101fcd26f0fdc79f&scene=21#wechat_redirect)[云数据库战争已经进入下半场](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672402&idx=1&sn=84bbac456446dfae896e891ae1fe8b97&chksm=84fdcc2fb38a45394cea7d367eb865a9acc1c9c261c8abe5053452649e01101fcd26f0fdc79f&scene=21#wechat_redirect)

[性能神化，聊聊 Exadata 的 “七宗罪”](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672109&idx=1&sn=c2131da37e77f154933e8fa2802381dc&chksm=84fdcd50b38a4446859bd4245ad4775b30652e4fe93bfd38cdaf595d837747c570487ff2e0e8&scene=21#wechat_redirect)

[盘点 2019：对国产数据库的一点观察和总结](http://mp.weixin.qq.com/s?__biz=MzA3OTg5NjcyMg==&mid=2661672584&idx=1&sn=58500b9f9543c6436134c79f1d2ad884&chksm=84fdcf75b38a4663dee5883cae6b7fab29e8c0e75b1206aa083ce9c8d806369b2fbbe360a3a8&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_jpg/jYB6WXyGuicfoSgsaibGk18b43qUwjE1N7V8zV9MLdKMGNia8SrR80OhDZH7hT7HGAU2ehFE8VQpWPm6ml4E11ic7Q/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_png/jYB6WXyGuicfoSgsaibGk18b43qUwjE1N7ktNtm0Uhk62X6qn452TkCoYpygGs7K86rszZXCiaDD115wJ43jeBkkg/640?wx_fmt=png)

讲述数据领域的故事

![](https://mmbiz.qpic.cn/mmbiz_png/jYB6WXyGuicfoSgsaibGk18b43qUwjE1N7I2nwW8pRZmibYdzV6Vp2pibB6wzUx0M3FMFY3jhoMCLEaAfHEVryoRuw/640?wx_fmt=png)

欢迎订阅老鱼笔记

✬如果你喜欢这篇文章，欢迎分享到朋友圈✬

评论功能现已开启，灰常接受一切形式的吐槽和赞美☺